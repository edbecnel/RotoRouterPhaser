<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>RotoRouter — Game Rules & How-To</title>
<style>
  :root{ color-scheme: light dark; }
  body{
    margin:0;
    font:14px/1.45 "Segoe UI", Roboto, Arial, sans-serif;
    color:#111;
    background:#f7f8fb;
  }
  /* Center the content column, keep text left-aligned */
  .container{
    max-width: 900px;          /* controls how “wide” the help page can get */
    margin: 36px auto;         /* centers the column */
    padding: 0 24px;           /* keeps it off the edges on small screens */
    background:#fff;
    border:1px solid #e5e8f0;
    border-radius:16px;
    box-shadow: 0 10px 26px rgba(0,0,0,0.06);
    text-align: left;          /* ensure left-justified text */
  }
  h1{ font-size:28px; margin:20px 16px 6px; }
  h2{ font-size:20px; margin:18px 16px 6px; color:#2b3a67; }
  h3{ font-size:16px; margin:12px 16px 4px; color:#384766; }
  p, ul, ol{ margin: 8px 16px; }
  ul, ol{ padding-left: 22px; }
  .tip{ font-size:13px; color:#555; margin: 6px 16px 14px; }
  .note{ font-size:12px; color:#666; margin: 12px 16px 18px; }
  .mono{ font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, "Liberation Mono", monospace; }
  @media (prefers-color-scheme: dark){
    body{ background:#0b0f18; color:#e6e6e6; }
    .container{
      background:#0d1220; border-color:#1f2636; box-shadow:none;
    }
    h2{ color:#b7c1ff; }
    h3{ color:#c5cbe9; }
    .tip{ color:#9da6b8; }
    .note{ color:#8a93a8; }
  }
</style>
</head>
<body>
  <main class="container">
    <h1>RotoRouter — Quick How-To</h1>

    <h2>Objective</h2>
    <p>Be the first to <b>score 3 corners</b> by moving your tokens onto <i>three different opponents’ corner squares</i>.</p>
    <ul>
      <li>Each player has <b>3 tokens</b>.</li>
      <li>When a token reaches an opponent’s corner, it <b>scores</b> and is <b>removed</b> from the board.</li>
      <li>At <b>3/3</b> you’re finished and will be auto-skipped.</li>
    </ul>

    <h2>Setup</h2>
    <ul>
      <li>Choose board size: <b>7×7</b> or <b>9×9</b> (Main Menu).</li>
      <li>Each color may be marked <b>Active</b> or left <b>Inactive</b> (minimum 2 active, maximum 4).</li>
      <li>Active players may also be flagged as <b>AI</b> and assigned a custom <b>name</b>.</li>
      <li>Inactive colors are skipped in turn order and appear dimmed in the Corners display.</li>
      <li>Start with no tokens on the board; your color’s corner is your <i>home corner</i>.</li>
    </ul>
    <h2>The Deck — Track Cards</h2>
    <ul>
      <li><b>Straight (─)</b> — 2 exits (East ↔ West)</li>
      <li><b>Elbow (└)</b> — 2 exits (turn; base North ↔ East)</li>
      <li><b>T (┴)</b> — 3 exits (base North, East, West; closed South)</li>
      <li><b>Cross (┼)</b> — 4 exits (North, South, East, West)</li>
    </ul>

    <h2>The Deck — Rotation &amp; Replacement (Dual-Use)</h2>
    <p>These cards can <b>act on existing tiles</b> <i>or</i> be <b>used to place new tracks</b> just like their normal counterparts.</p>
    <ul>
      <li><b>RS</b> — rotate an existing <b>Straight</b> <i>or</i> place a new <b>Straight</b></li>
      <li><b>RE</b> — rotate an existing <b>Elbow</b> <i>or</i> place a new <b>Elbow</b></li>
      <li><b>RT</b> — rotate an existing <b>T</b> <i>or</i> place a new <b>T</b></li>
      <li><b>RC</b> — replace <i>any</i> existing tile with a <b>Cross</b> <i>or</i> place a new <b>Cross</b></li>
    </ul>

    <p><b>Deck scaling:</b> With 2–3 active players, your personal deck grows so total track supply stays healthy.
    The game also enforces per-player minimums (7×7: 7/6/3/1; 9×9: 9/8/3/1 for Straight/Elbow/T/Cross).
    Rotation cards (<b>RS/RE/RT/RC</b>) scale too. Decks are built at <b>New Game</b> from the chosen board size and active player count.</p>

    <p><b>Deck scaling:</b> With 2–3 active players, your personal deck grows so total track supply stays healthy. The game also enforces per-player minimums (7×7: 7/6/3/1; 9×9: 9/8/3/1 for Straight/Elbow/T/Cross). Rotation cards (<b>RS/RE/RT/RC</b>) scale too. Decks are built at <b>New Game</b> from the chosen board size and active player count.</p>

    <p class="tip"><i>Tip:</i> While a placement “ghost” is shown, use <b>Q</b>/<b>E</b> to rotate before confirming.</p>

    <h3>Track colors</h3>
    <ul>
      <li>Newly placed tracks adopt the <b>placing player’s color</b>.</li>
      <li><b>RC on an existing tile</b>: the Cross <b>keeps the replaced tile’s color</b>. (RC into an empty cell uses the placing player’s color.)</li>
    </ul>

    <h2>Turn Flow</h2>
    <ol>
      <li><b>Draw</b> a card (if you don’t already hold one).</li>
      <li><b>Play</b>:
        <ul>
          <li>Place a track (Straight/Elbow/T/Cross) in a legal empty cell, <i>or</i></li>
          <li>Use <b>RS/RE/RT</b> to rotate a matching placed tile, <i>or</i> use <b>RC</b> to replace any tile with a Cross, <i>or</i></li>
          <li>(Dual-use) play RS/RE/RT/RC as their <b>normal track</b> in an empty cell.</li>
          <li><b>Touch rotation mode:</b> Tap a legal empty cell once to enter <i>rotation mode</i> — the ghost stays visible. Use the ⟲ / ⟳ buttons (or Q/E) to rotate, then tap again or press <b>Confirm</b> to place.</li>
        </ul>
      </li>
      <li><b>Token Action</b> (optional): place a new token on your home corner (if there is a track on the home corner) <i>or</i> move one token along connected tracks to any reachable empty cell.</li>
      <li><b>End Turn</b>.</li>
    </ol>
    <p class="tip"><i>Forced play:</i> If a forced card has <b>no legal placement</b>, the force is <b>waived</b>; you may Bottom it.</p>
    <h2>AI Players</h2>
      <ul>
        <li><b>Targeting:</b> moves toward the last unreached corner; avoids short loops.</li>
        <li><b>Rotation gating:</b> the AI <b>only rolls to rotate after probing</b> for a legal token move. If a legal move exists, it will not roll pre-emptively.</li>
        <li><b>Stall recovery:</b> when progress stalls, the AI cycles one card and performs <b>at most one</b> die rotation before re-evaluating.</li>
        <li><b>Legality:</b> follows the same adjacency rules as players; won’t place tiles that only touch opponent tracks without connecting.</li>
        <li><b>Card economy:</b> prefers saving RS/RE/RT/RC for endgame; Bottoms low-value cards only when not forced.</li>
        <li><b>Save/Load safe:</b> AI flags and counters persist in saved games.</li>
      </ul>
    <h2>Forced Play Rules</h2>
    <ul>
      <li><b>3 Skipped Tracks:</b> If you skip 3 track cards in a row, on your <b>next turn</b> you must <b>Draw and Place</b> the card drawn (if there is a legal placement). Bottom and End Turn are disabled until you place it.</li>
      <li><b>3 Skipped Elbows:</b> If you skip 3 Elbows, the <b>next Elbow you draw must be placed</b> immediately (if there is a legal placement). Bottom and End Turn are disabled until the Elbow is placed.</li>
      <li>If the forced card has <b>no legal placement</b>, the force is <b>waived</b> to avoid deadlocks — you may Bottom it and end your turn normally.</li>
      <li><b>HUD reset:</b> when the elbow-skip counter returns to <b>0/3</b> (or the force is waived), the warning style clears and the counter returns to its normal color.</li>
      <li><b>Undo safety:</b> Undo/Redo during a forced turn preserves the forced state. <b>Bottom</b> remains disabled until you complete or waive the forced placement.</li>
      <li><b>HUD banner:</b> During a forced turn, the status line now shows <b>“Forced: Draw &amp; Place”</b> before you draw.</li>
    </ul>
    <h2>Legal Placement &amp; Connections</h2>
    <h3>Track placement</h3>
    <ul>
      <li>Place only into an <b>empty</b> cell.</li>
      <li>The cell must be <b>adjacent</b> (N/S/E/W) to at least one track connected to your network.</li>
      <li>Touching sides must have <b>matching, reciprocal exits</b> to connect to opponent networks.</li>
      <li><b>Adjacency rule:</b> You may place next to your own network even if the new tile does not connect.
Opponents may place adjacent to your tracks only if their new tile connects to your network; once two networks connect, both sides may build adjacent along that shared network.</li>
    </ul>
    <h3>Connected network</h3>
    <ul>
      <li>Tracks connect via continuous chains of matching exits.</li>
      <li>Highlights show legal empty cells adjacent to your network.</li>
    </ul>
    <h3>Rotation / replacement</h3>
    <ul>
      <li><b>RS/RE/RT</b>: click matching tile → rotate with <b>Q/E</b> → click to confirm.</li>
      <li><b>RC</b>: click any tile to make it a <b>Cross</b> (rotate before confirming if desired).</li>
      <li>(Dual-use) You may also play these as new tracks of their base type.</li>
    </ul>
    <p class="tip"><i>Tip:</i> On tablets or touchscreens, use the <b>⟲ CCW</b> and <b>⟳ CW</b> buttons on the sidebar to rotate when a track is in rotation mode. Press <b>Confirm</b> (formerly “Place”) or tap the same cell again to commit.</p>

    <h2>Standings & Rankings</h2>
    <p>
      A new <b>Standings panel</b> appears at the top of the sidebar showing all <b>active players</b> and their
      <b>current ranks</b>. Each entry includes a color swatch, name, and score, all kept together on one line.
    </p>
    <ul>
      <li>Before the first score, no ranks are shown.</li>
      <li>When the first token reaches an opponent’s corner, that player becomes <b>1st</b> (bold), and all others become <b>2nd</b>.</li>
      <li>As more corners are scored, the standings update automatically, showing <b>T-1st</b>, <b>T-2nd</b>, etc. for ties.</li>
      <li>Inactive colors are not listed in the Standings panel.</li>
      <li>The Corners table now includes a new <b>Place</b> column that mirrors these ranks.</li>
    </ul>
    <p class="tip"><i>Tip:</i> Standings refresh automatically after every scoring event or Undo/Redo that affects scores.</p>

    <h2>Tokens &amp; Scoring</h2>
    <ul>
      <li><b>Place</b> a token on your home corner if a track is present on that corner.</li>
      <li><b>Move</b> a token along connected paths to any reachable empty cell (one move per turn).</li>
      <li><b>Score</b> by ending on an opponent’s corner; remove the moving token from the board.</li>
      <li>On <b>3/3</b>, your turn ends immediately; you’re auto-skipped thereafter.</li>
      <li><b>Pass-through corners:</b> tokens may <b>pass through</b> corners they have already scored, but may <b>not stop</b> on them again.</li>
    </ul>

    <h2>Bottoming (Recycle)</h2>
    <p><b>Bottoming</b> moves the held card to the <b>bottom of your personal draw pile</b> (recycled, not discarded).</p>
    <ul>
      <li>If the card has <b>no legal placement</b>, you may Bottom it <b>with no penalty</b>.</li>
      <li>If it <b>does</b> have a legal placement and you Bottom it, it counts as a <b>skip</b> (shown in HUD).</li>
      <li>The card will return later as your deck cycles.</li>
    </ul>

    <h2>Ending the Game</h2>
    <ul>
      <li>When all remaining players are finished/out: <b style="color:#28a745;">All players have finished — game over.</b></li>
      <li><b>Winner:</b> first to reach 3/3 scored corners; ties break by earliest to 3/3.</li>
    </ul>
    <h2>Dead-Straight Fix</h2>
    <p>If a Straight track becomes completely trapped by perpendicular Straights (cannot extend), it is highlighted. At the <b>start of your turn</b> you may replace one such Straight with a <b>Cross</b> for free. Tokens on the cell remain.</p>
    <h2>Corner Fix</h2>
    <p>If your own home corner becomes sealed by perpendicular Straights, you must replace that corner with a <b>Cross</b> before continuing play. A red HUD warning will guide you until the fix is made.</p>
    <p class="note"><i>Edge cases:</i> forced cards with zero legal placements are waived; HUD shows the actual token count and flags mismatches with a small warning.</p>
  </main>
</body>
</html>
